#!/bin/bash

function parse_git_branch_and_add_brackets {
  git branch --no-color 2> /dev/null | sed -e '/^[^*]/d' -e 's/* \(.*\)/\ \[\1\]/'
}

RED="\[\033[0;31m\]" #red
GRN="\[\033[0;32m\]" #green
YEL="\[\033[0;33m\]" #yellow
BLU="\[\033[0;34m\]" #brown
PUR="\[\033[0;35m\]" #purple
CYN="\[\033[0;36m\]" #cyan
COLOR_RESET="\[\033[0m\]"

NM="\[\033[0;38m\]" #means no background and white lines
HIB=$GRN #change this for bg colors
SI=$YEL #this is for the current directory
IN="\[\033[0m\]"
DT=$PUR

function get_dir() {
  p=`pwd`
  if [[ "$p" == "$HOME" ]]; then
    echo "🏠 "
  else
    echo ${p/$HOME/🏠 } | grep -o [^\/][^\/]*\/[^\/][^\/]*$ || pwd
  fi

}

function get_prompt() {
       #2 directories        git branch
  echo "\e]2;\$(get_dir)\a$SI\$(get_dir)$HIB\$(parse_git_branch_and_add_brackets)`user_at_host`$COLOR_RESET: "
}

function user_at_host() {
  md5=$(which md5 || which md5sum)
  # if we're connected over SSH, show the user and hostname
  if [ "$SSH_CONNECTION" != "" ]
  then
    # hash the hostname, convert to decimal, and mod 6
    number=$(expr `echo $((0x\`hostname | $md5 | awk '{print $1}'\`))` % 6)

    # take the absolute value
    number=`echo ${number#-}`

    # add it to 31 (fg colors are 31-37)
    number=$(expr $number + 31)

    # create the color string
    color="\033[0;$number"m

    # debug
    #echo color $color 1>&2

    echo -n " $color|$USER@$HOSTNAME|$COLOR_RESET"
  fi
}

export PS1=`get_prompt`
